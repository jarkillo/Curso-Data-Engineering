# Procesador CSV - Proyecto Pr√°ctico

Proyecto pr√°ctico del **Tema 2: Procesamiento de Archivos CSV** del Master en Data Engineering.

Este proyecto implementa un procesador CSV robusto siguiendo **TDD estricto**, **arquitectura funcional** y **buenas pr√°cticas de Data Engineering**.

---

## üìã Contenido

- [Caracter√≠sticas](#caracter√≠sticas)
- [Instalaci√≥n](#instalaci√≥n)
- [Uso R√°pido](#uso-r√°pido)
- [Documentaci√≥n de Funciones](#documentaci√≥n-de-funciones)
- [Ejemplos](#ejemplos)
- [Tests](#tests)
- [Arquitectura](#arquitectura)
- [Buenas Pr√°cticas Implementadas](#buenas-pr√°cticas-implementadas)

---

## ‚ú® Caracter√≠sticas

- ‚úÖ **Lectura robusta de CSV** con validaci√≥n de archivos
- ‚úÖ **Detecci√≥n autom√°tica de delimitadores** (`,`, `;`, `\t`)
- ‚úÖ **Validaci√≥n de datos** seg√∫n tipos y reglas de negocio
- ‚úÖ **Transformaci√≥n de datos** (filtrado, columnas calculadas)
- ‚úÖ **Consolidaci√≥n de m√∫ltiples CSV** en uno solo
- ‚úÖ **Soporte para m√∫ltiples encodings** (UTF-8, Latin-1, etc.)
- ‚úÖ **Manejo robusto de errores** con mensajes claros
- ‚úÖ **Cobertura de tests del 99%**
- ‚úÖ **Funciones puras** sin efectos colaterales
- ‚úÖ **Tipado expl√≠cito** en todas las funciones

---

## üöÄ Instalaci√≥n

### Requisitos

- Python 3.8+
- pip

### Pasos

```bash
# 1. Clonar el repositorio (o navegar al directorio)
cd modulo-01-fundamentos/tema-2-procesamiento-csv/04-proyecto-practico

# 2. Instalar dependencias
pip install -r requirements.txt
```

---

## ‚ö° Uso R√°pido

### Ejemplo B√°sico

```python
from src.lector_csv import leer_csv
from src.escritor_csv import escribir_csv

# Leer CSV
datos = leer_csv("datos.csv")

# Procesar datos
datos_procesados = [fila for fila in datos if int(fila["edad"]) > 25]

# Escribir resultado
escribir_csv(datos_procesados, "resultado.csv")
```

### Ejemplo con Validaci√≥n

```python
from src.lector_csv import leer_csv
from src.validador_csv import validar_fila

# Leer datos
datos = leer_csv("datos.csv")

# Validar cada fila
validaciones = {
    "nombre": str,
    "edad": int,
    "ciudad": str
}

for fila in datos:
    errores = validar_fila(fila, validaciones)
    if errores:
        print(f"Errores: {errores}")
```

---

## üìö Documentaci√≥n de Funciones

### M√≥dulo: `lector_csv`

#### `leer_csv(ruta_archivo, delimitador=",", encoding="utf-8")`

Lee un archivo CSV y retorna una lista de diccionarios.

**Par√°metros:**
- `ruta_archivo` (str): Ruta al archivo CSV
- `delimitador` (str): Delimitador usado (por defecto: `,`)
- `encoding` (str): Codificaci√≥n del archivo (por defecto: `utf-8`)

**Retorna:**
- `List[Dict[str, str]]`: Lista de diccionarios con los datos

**Lanza:**
- `FileNotFoundError`: Si el archivo no existe
- `ValueError`: Si el archivo est√° vac√≠o

**Ejemplo:**
```python
datos = leer_csv("ventas.csv")
# [{'producto': 'Laptop', 'precio': '899.99'}, ...]
```

---

#### `detectar_delimitador(ruta_archivo)`

Detecta autom√°ticamente el delimitador usado en un archivo CSV.

**Par√°metros:**
- `ruta_archivo` (str): Ruta al archivo CSV

**Retorna:**
- `str`: Delimitador detectado (`,`, `;`, `\t`, etc.)

**Lanza:**
- `FileNotFoundError`: Si el archivo no existe

**Ejemplo:**
```python
delimitador = detectar_delimitador("datos.csv")
# ','
```

---

#### `validar_archivo_existe(ruta_archivo)`

Valida que un archivo existe y no est√° vac√≠o.

**Par√°metros:**
- `ruta_archivo` (str): Ruta al archivo CSV

**Lanza:**
- `FileNotFoundError`: Si el archivo no existe
- `ValueError`: Si el archivo est√° vac√≠o

**Ejemplo:**
```python
validar_archivo_existe("datos.csv")
# No lanza error si el archivo es v√°lido
```

---

### M√≥dulo: `escritor_csv`

#### `escribir_csv(datos, ruta_archivo, headers=None, delimitador=",", encoding="utf-8")`

Escribe una lista de diccionarios en un archivo CSV.

**Par√°metros:**
- `datos` (List[Dict[str, str]]): Lista de diccionarios con los datos
- `ruta_archivo` (str): Ruta donde guardar el archivo
- `headers` (List[str], opcional): Lista de headers (se infiere si no se proporciona)
- `delimitador` (str): Delimitador a usar (por defecto: `,`)
- `encoding` (str): Codificaci√≥n del archivo (por defecto: `utf-8`)

**Lanza:**
- `ValueError`: Si datos est√° vac√≠o y no se proporcionan headers

**Ejemplo:**
```python
datos = [{"nombre": "Ana", "edad": "25"}]
escribir_csv(datos, "salida.csv")
```

---

### M√≥dulo: `validador_csv`

#### `validar_headers(ruta_archivo, headers_esperados, delimitador=",")`

Valida que un archivo CSV tiene los headers esperados.

**Par√°metros:**
- `ruta_archivo` (str): Ruta al archivo CSV
- `headers_esperados` (List[str]): Lista de headers que debe tener el archivo
- `delimitador` (str): Delimitador usado (por defecto: `,`)

**Retorna:**
- `bool`: True si los headers coinciden, False si no

**Lanza:**
- `FileNotFoundError`: Si el archivo no existe

**Ejemplo:**
```python
valido = validar_headers("datos.csv", ["nombre", "edad", "ciudad"])
# True o False
```

---

#### `validar_tipo_dato(valor, tipo_esperado)`

Valida que un valor puede ser convertido al tipo esperado.

**Par√°metros:**
- `valor` (str): Valor a validar
- `tipo_esperado` (Type): Tipo de dato esperado (int, float, str)

**Retorna:**
- `bool`: True si el valor puede ser convertido, False si no

**Ejemplo:**
```python
validar_tipo_dato("25", int)  # True
validar_tipo_dato("abc", int)  # False
```

---

#### `validar_fila(fila, validaciones)`

Valida una fila del CSV seg√∫n reglas de validaci√≥n.

**Par√°metros:**
- `fila` (Dict[str, str]): Diccionario con los datos de la fila
- `validaciones` (Dict[str, Type]): Diccionario {columna: tipo_esperado}

**Retorna:**
- `List[str]`: Lista de errores encontrados (vac√≠a si todo est√° bien)

**Ejemplo:**
```python
fila = {"nombre": "Ana", "edad": "25"}
validaciones = {"nombre": str, "edad": int}
errores = validar_fila(fila, validaciones)
# [] (sin errores)
```

---

### M√≥dulo: `transformador_csv`

#### `filtrar_filas(datos, condicion)`

Filtra filas de datos seg√∫n una condici√≥n.

**Par√°metros:**
- `datos` (List[Dict[str, str]]): Lista de diccionarios con los datos
- `condicion` (Callable): Funci√≥n que retorna True si la fila debe incluirse

**Retorna:**
- `List[Dict[str, str]]`: Nueva lista con solo las filas que cumplen la condici√≥n

**Ejemplo:**
```python
datos = [{"nombre": "Ana", "edad": "25"}, {"nombre": "Luis", "edad": "30"}]
mayores_25 = filtrar_filas(datos, lambda fila: int(fila["edad"]) > 25)
# [{"nombre": "Luis", "edad": "30"}]
```

---

#### `agregar_columna(datos, nombre_columna, funcion_calculo)`

Agrega una nueva columna calculada a los datos.

**Par√°metros:**
- `datos` (List[Dict[str, str]]): Lista de diccionarios con los datos
- `nombre_columna` (str): Nombre de la nueva columna
- `funcion_calculo` (Callable): Funci√≥n que calcula el valor de la nueva columna

**Retorna:**
- `List[Dict[str, str]]`: Nueva lista con la columna adicional

**Ejemplo:**
```python
datos = [{"precio": "10", "cantidad": "2"}]
resultado = agregar_columna(
    datos,
    "total",
    lambda f: str(float(f["precio"]) * int(f["cantidad"]))
)
# [{"precio": "10", "cantidad": "2", "total": "20.0"}]
```

---

#### `consolidar_csvs(archivos, archivo_salida, delimitador=",", encoding="utf-8")`

Consolida m√∫ltiples archivos CSV en uno solo.

**Par√°metros:**
- `archivos` (List[str]): Lista de rutas a los archivos CSV
- `archivo_salida` (str): Ruta donde guardar el archivo consolidado
- `delimitador` (str): Delimitador usado (por defecto: `,`)
- `encoding` (str): Codificaci√≥n de los archivos (por defecto: `utf-8`)

**Lanza:**
- `ValueError`: Si la lista est√° vac√≠a o si los headers no coinciden
- `FileNotFoundError`: Si alg√∫n archivo no existe

**Ejemplo:**
```python
consolidar_csvs(["ventas_a.csv", "ventas_b.csv"], "consolidado.csv")
```

---

### M√≥dulo: `utilidades`

#### `contar_filas(ruta_archivo)`

Cuenta el n√∫mero de filas de datos en un archivo CSV (sin contar el header).

**Par√°metros:**
- `ruta_archivo` (str): Ruta al archivo CSV

**Retorna:**
- `int`: N√∫mero de filas de datos

**Lanza:**
- `FileNotFoundError`: Si el archivo no existe
- `ValueError`: Si el archivo est√° vac√≠o

**Ejemplo:**
```python
num_filas = contar_filas("datos.csv")
# 10
```

---

#### `obtener_headers(ruta_archivo, delimitador=",")`

Obtiene la lista de headers (nombres de columnas) de un archivo CSV.

**Par√°metros:**
- `ruta_archivo` (str): Ruta al archivo CSV
- `delimitador` (str): Delimitador usado (por defecto: `,`)

**Retorna:**
- `List[str]`: Lista con los nombres de las columnas

**Lanza:**
- `FileNotFoundError`: Si el archivo no existe
- `ValueError`: Si el archivo est√° vac√≠o

**Ejemplo:**
```python
headers = obtener_headers("datos.csv")
# ['nombre', 'edad', 'ciudad']
```

---

## üí° Ejemplos

El proyecto incluye 3 ejemplos ejecutables en la carpeta `ejemplos/`:

### 1. Ejemplo B√°sico (`ejemplo_basico.py`)

Muestra c√≥mo leer, procesar y escribir archivos CSV.

```bash
python ejemplos/ejemplo_basico.py
```

### 2. Ejemplo de Validaci√≥n (`ejemplo_validacion.py`)

Muestra c√≥mo validar datos CSV seg√∫n reglas de negocio.

```bash
python ejemplos/ejemplo_validacion.py
```

### 3. Ejemplo de Pipeline (`ejemplo_pipeline.py`)

Muestra un pipeline completo: Extract ‚Üí Validate ‚Üí Transform ‚Üí Load.

```bash
python ejemplos/ejemplo_pipeline.py
```

---

## üß™ Tests

El proyecto tiene **54 tests** con una **cobertura del 99%**.

### Ejecutar Tests

```bash
# Ejecutar todos los tests
pytest tests/

# Ejecutar con cobertura
pytest tests/ --cov=src --cov-report=term --cov-report=html

# Ejecutar tests de un m√≥dulo espec√≠fico
pytest tests/test_lector_csv.py -v
```

### Cobertura de Tests

```
Name                       Stmts   Miss  Cover
----------------------------------------------
src/__init__.py                1      0   100%
src/escritor_csv.py           11      0   100%
src/lector_csv.py             24      0   100%
src/transformador_csv.py      30      0   100%
src/utilidades.py             22      0   100%
src/validador_csv.py          36      1    97%
----------------------------------------------
TOTAL                        124      1    99%
```

---

## üèõÔ∏è Arquitectura

### Principios de Dise√±o

1. **Funcional First**: Funciones puras sin clases innecesarias
2. **Modularidad**: Cada m√≥dulo tiene una responsabilidad clara
3. **Sin Efectos Colaterales**: Las funciones no modifican sus par√°metros
4. **Composabilidad**: Las funciones se pueden combinar f√°cilmente
5. **Expl√≠cito sobre Impl√≠cito**: Nombres claros, comportamiento obvio

### Estructura del Proyecto

```
04-proyecto-practico/
‚îú‚îÄ‚îÄ src/                      # C√≥digo fuente
‚îÇ   ‚îú‚îÄ‚îÄ lector_csv.py        # Funciones de lectura
‚îÇ   ‚îú‚îÄ‚îÄ escritor_csv.py      # Funciones de escritura
‚îÇ   ‚îú‚îÄ‚îÄ validador_csv.py     # Funciones de validaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ transformador_csv.py # Funciones de transformaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ utilidades.py        # Funciones auxiliares
‚îÇ
‚îú‚îÄ‚îÄ tests/                    # Tests (cobertura 99%)
‚îÇ   ‚îú‚îÄ‚îÄ test_lector_csv.py
‚îÇ   ‚îú‚îÄ‚îÄ test_escritor_csv.py
‚îÇ   ‚îú‚îÄ‚îÄ test_validador_csv.py
‚îÇ   ‚îú‚îÄ‚îÄ test_transformador_csv.py
‚îÇ   ‚îî‚îÄ‚îÄ test_utilidades.py
‚îÇ
‚îú‚îÄ‚îÄ ejemplos/                 # Ejemplos ejecutables
‚îÇ   ‚îú‚îÄ‚îÄ ejemplo_basico.py
‚îÇ   ‚îú‚îÄ‚îÄ ejemplo_validacion.py
‚îÇ   ‚îî‚îÄ‚îÄ ejemplo_pipeline.py
‚îÇ
‚îú‚îÄ‚îÄ datos/                    # Datos de ejemplo
‚îÇ   ‚îî‚îÄ‚îÄ muestra.csv
‚îÇ
‚îú‚îÄ‚îÄ README.md                 # Este archivo
‚îî‚îÄ‚îÄ requirements.txt          # Dependencias
```

---

## ‚úÖ Buenas Pr√°cticas Implementadas

### 1. TDD Estricto

- ‚úÖ Tests escritos **PRIMERO**, implementaci√≥n despu√©s
- ‚úÖ Ciclo Red ‚Üí Green ‚Üí Refactor
- ‚úÖ Cobertura del 99%

### 2. Tipado Expl√≠cito

```python
def leer_csv(
    ruta_archivo: str,
    delimitador: str = ",",
    encoding: str = "utf-8"
) -> List[Dict[str, str]]:
    ...
```

### 3. Docstrings Completos

Todas las funciones tienen docstrings con:
- Descripci√≥n
- Par√°metros
- Retorno
- Excepciones
- Ejemplos

### 4. Manejo Robusto de Errores

```python
if not os.path.exists(ruta_archivo):
    raise FileNotFoundError(f"El archivo no existe: {ruta_archivo}")
```

### 5. Funciones Puras

```python
# ‚úÖ CORRECTO: No modifica la lista original
def agregar_columna(datos, nombre, funcion):
    resultado = []
    for fila in datos:
        nueva_fila = fila.copy()  # Copia
        nueva_fila[nombre] = funcion(fila)
        resultado.append(nueva_fila)
    return resultado
```

### 6. Rutas Multiplataforma

```python
import os
from pathlib import Path

# Funciona en Windows, Linux y Mac
ruta = Path("datos") / "archivo.csv"
```

### 7. Context Managers

```python
# Cierre autom√°tico de archivos
with open(archivo, "r", encoding="utf-8") as f:
    datos = f.read()
```

### 8. Encoding Expl√≠cito

```python
# Siempre especificar encoding
with open(archivo, "r", encoding="utf-8") as f:
    ...
```

---

## üîí Seguridad

### Validaciones Implementadas

- ‚úÖ Validaci√≥n de existencia de archivos
- ‚úÖ Validaci√≥n de archivos vac√≠os
- ‚úÖ Validaci√≥n de tipos de datos
- ‚úÖ Validaci√≥n de headers esperados
- ‚úÖ Manejo expl√≠cito de errores

### Mejoras de Seguridad Recomendadas

1. **L√≠mite de tama√±o de archivo**: A√±adir validaci√≥n para archivos muy grandes
2. **Sanitizaci√≥n de rutas**: Validar que las rutas no contengan `..` (path traversal)
3. **L√≠mite de memoria**: Implementar procesamiento streaming para archivos grandes
4. **Validaci√≥n de encoding**: Detectar y manejar encodings incorrectos

---

## üìù Convenciones de C√≥digo

- **Funciones y variables**: `snake_case`
- **Constantes**: `MAYUSCULAS_CON_GUIONES`
- **Clases**: `PascalCase` (solo para conectores externos)
- **Archivos**: `snake_case.py`
- **Sin tildes ni espacios** en nombres

---

## ü§ù Contribuir

Este es un proyecto educativo del Master en Data Engineering. Para contribuir:

1. Seguir las reglas del archivo `REGLAS_CRITICAS_AGENTES.md`
2. Escribir tests PRIMERO (TDD)
3. Mantener cobertura >80%
4. Usar tipado expl√≠cito
5. Documentar con docstrings completos

---

## üìÑ Licencia

Proyecto educativo del Master en Data Engineering.

---

## üë®‚Äçüíª Autor

Proyecto pr√°ctico desarrollado siguiendo metodolog√≠a TDD y arquitectura funcional.

---

**√öltima actualizaci√≥n:** 2025-10-19
